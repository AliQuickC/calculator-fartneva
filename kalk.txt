<p style="font-size:16px;">
<table class="calk">
    <tr>
        <td><p style="font-size:16px;font-weight:bold;margin-bottom:4px;">Деревянные бытовки:</p></td>
        
        <td><p style="font-size:16px;font-weight:bold;margin-bottom:4px;">Металлические бытовки:</p></td>
    </tr>
    <tr>
        <td class="calk-level2">
            <ul>
                <li><a href="javascript:void(0)" class="show-for-derevo" data-src='images/bk-01.jpg' data-price='67000' data-changehouse="type1">Деревянная бытовка без перегородки</a></li>
                <li><a href="javascript:void(0)" class="show-for-derevo" data-src='images/bk-02.jpg' data-price='77000' data-changehouse="type2">Деревянная бытовка с прямой перегородкой</a></li>
                <li><a href="javascript:void(0)" class="show-for-derevo" data-src='images/bt-03.jpg' data-price='97000' data-changehouse="type3">Деревянная бытовка с двойной перегородкой</a></li>
            </ul>
        </td>
        
        <td class="calk-level2">
            <ul>
                <li><a href="javascript:void(0)" class="show-for-metal" data-src='images/bk-01.jpg' data-price='113800' data-changehouse="metalWithoutPartition">Металлическая бытовка без перегородки</a></li>
                <li><a href="javascript:void(0)" class="show-for-metal" data-src='images/bk-02.jpg' data-price='123800' data-changehouse="metalWithStraightPartition">Металлическая бытовка с прямой перегородкой</a></li>
                <li><a href="javascript:void(0)" class="show-for-metal" data-src='images/bt-03.jpg' data-price='133800' data-changehouse="metalWithDoublePartition">Металлическая бытовка с двойной перегородкой</a></li>
            </ul>
        </td>
    </tr>
</table>


<p class="bt-info" style="display:none">Стоимость базовой комплектации – <span class="info-price"></span> р.</p>

<table id="custom-order">
    <thead>
        <tr>
            <th width="482px" style="text-align:left;">Комплектация</th>
            <th width="209px" style="text-align:right;">Стоимость</th>
        </tr>
    </thead>
    <tbody>

		<tr class="for-metal hidden">
			<td class="c-name">
				<fieldset style="border-radius: 3px; cursor: default; display: flex; flex-wrap: wrap; column-gap: 10px;">
					<legend>Размер:</legend>
					<label for="ch55">
						<input type="radio" name="metal-size" id="ch55" data-size="2,4x2,4" data-price="">
						2,4м. x 2,4м.
					</label>
					<label for="ch56">
						<input type="radio" name="metal-size" id="ch56" data-size="2,4x4" data-price="">
						2,4м. x 4м.
					</label>
					<label for="ch57">
						<input type="radio" name="metal-size" id="ch57" data-size="2,4x6" data-price="">
						2,4м. x 6м.
					</label>
					<label for="ch58">
						<input type="radio" name="metal-size" id="ch58" data-size="2,4x8" data-price="">
						2,4м. x 8м.
					</label>
				</fieldset>
			</td>
			<td class="c-price" style="visibility: hidden"></td>
		</tr>

<tr class="for-derevo hidden"><td class="c-name"><label for="ch1"><input id="ch1" type="checkbox">Окно деревянное глухое (шт)</label></td><td class="c-price" data-base-price="4000">4000</td></tr>
<tr class="for-derevo hidden"><td class="c-name"><label for="ch2"><input id="ch2" type="checkbox">Окно деревянное открывающееся 1 остекление (шт)</label></td><td class="c-price" data-base-price="5000">5000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch3"><input id="ch3" type="checkbox">Окно деревянное открывающееся  2 остекление (шт)</label></td><td class="c-price" data-base-price="6000">6000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch4"><input id="ch4" type="checkbox">Окно ПВХ 1.1*0,8 (шт)</label></td><td class="c-price" data-base-price="8000">8000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch5"><input id="ch6" type="checkbox">Утепление 100мм</label></td><td class="c-price" data-base-price="10000">10000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch6"><input id="ch7" type="checkbox">Дополнительная перегородка, ДВП 3,2 мм</label></td><td class="c-price" data-base-price="10000">10000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch7"><input id="ch8" type="checkbox">Дополнительная перегородка, вагонка хвойная</label></td><td class="c-price" data-base-price="10500">10500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch8"><input id="ch8" type="checkbox">Дополнительная перегородка, вагонка ПВХ</label></td><td class="c-price" data-base-price="11500">11500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch9"><input id="ch9" type="checkbox">Дополнительная перегородка, панели МДФ</label></td><td class="c-price" data-base-price="15500">15500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch10"><input id="ch10" type="checkbox">Пол из половой доски 25*100</label></td><td class="c-price" data-base-price="5000">5000</td></tr>

<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch11"><input id="ch11" type="checkbox">Электрика (гофра)</label></td><td class="c-price" data-base-price="7000">7000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch12"><input id="ch12" type="checkbox">Электрика "ЕВРО" (светильник ЛПО)</label></td><td class="c-price" data-base-price="12500">12500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch13"><input id="ch13" type="checkbox">Электрика "ЕВРО" (кабель NYM)</label></td><td class="c-price" data-base-price="12000">12000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch14"><input id="ch14" type="radio" name="roof1" title="Кровля ондулин (односкатная крыша)">Кровля ондулин (односкатная крыша)</label></td><td class="c-price" data-base-price="6500">6500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch15"><input id="ch15" type="radio" name="roof1" title="Кровля ондулин (двускатная крыша)">Кровля ондулин (двускатная крыша)</label></td><td class="c-price" data-base-price="6500">6500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch16"><input id="ch16" type="checkbox">Кровля с оцинковой (гладкий лист)</label></td><td class="c-price" data-base-price="5500">5500</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch17"><input id="ch17" type="checkbox">Отделка внутренняя, вагонка хвойная (потолок, стены)</label></td><td class="c-price" data-base-price="22000">22000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch18"><input id="ch18" type="checkbox">Отделка внутренняя, ОСБи (потолок, стены)</label></td><td class="c-price" data-base-price="15000">15000</td></tr>
<tr class="for-derevo hidden"><td class="c-name">
    <label for="ch19"><input id="ch19" type="checkbox">Отделка внутренняя, вагонка ПВХ (потолок, стены)</label></td><td class="c-price" data-base-price="11000">11000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch20"><input id="ch20" type="checkbox">Дно- железо оцинкованное 0.5мм </label></td><td class="c-price" data-base-price="5500">5500</td></tr>
<tr class="for-metal hidden" data-recalculation="uses"><td class="c-name">
    <label for="ch21"><input id="ch21" type="checkbox">Дополнительное утепление, УРСА 100мм</label></td><td class="c-price" data-base-price="10000">10000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch22"><input id="ch22" type="checkbox">Площадка металлическая 1,25*2,25 (шт)</label></td><td class="c-price" data-base-price="7500">7500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch23"><input id="ch23" type="checkbox">Лестница металлическая 3,5*0,9 (шт)</label></td><td class="c-price" data-base-price="12500">12500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch24"><input id="ch24" type="checkbox">Дверь входная техническая (окраска в цвет) (шт)</label></td><td class="c-price" data-base-price="24000">24000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch25"><input id="ch25" type="checkbox">Дверь входная металлическая (Россия) (шт)</label></td><td class="c-price" data-base-price="12000">12000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch26"><input id="ch26" type="checkbox">Дверь входная деревянная ДГ-9*21 (шт)</label></td><td class="c-price" data-base-price="5000">5000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch27"><input id="ch27" type="checkbox">Окно деревянное (шт)</label></td><td class="c-price" data-base-price="5000">5000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch28"><input id="ch28" type="checkbox">Окно ПВХ 1.1*0,8 (шт)</label></td><td class="c-price" data-base-price="8000">8000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch29"><input id="ch29" type="checkbox">Ставни деревянные</label></td><td class="c-price" data-base-price="2000">2000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch30"><input id="ch30" type="checkbox">Ставни металлические</label></td><td class="c-price" data-base-price="4500">4500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch31"><input id="ch31" type="checkbox">Решетка на окно металлическая</label></td><td class="c-price" data-base-price="4000">4000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch32"><input id="ch32" type="checkbox">Дополнительная перегородка, ДВП 3,2 мм</label></td><td class="c-price" data-base-price="11000">11000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch33"><input id="ch33" type="checkbox">Дополнительная перегородка, вагонка хвойная</label></td><td class="c-price" data-base-price="12000">12000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch34"><input id="ch34" type="checkbox">Дополнительная перегородка, вагонка ПВХ</label></td><td class="c-price" data-base-price="11000">11000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch35"><input id="ch35" type="checkbox">Дополнительная перегородка, панели МДФ</label></td><td class="c-price" data-base-price="10000">10000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch36"><input id="ch36" type="checkbox">Пол из половой доски</label></td><td class="c-price" data-base-price="5000">5000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch37"><input id="ch37" type="checkbox">Покраска пола </label></td><td class="c-price" data-base-price="1500">1500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch38"><input id="ch38" type="checkbox">Линолеум (1кв.м.)</label></td><td class="c-price" data-base-price="500">500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch39"><input id="ch39" type="checkbox">Электрика</label></td><td class="c-price" data-base-price="8000">8000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch40"><input id="ch40" type="checkbox">Электрика "ЕВРО" (светильник ЛПО)</label></td><td class="c-price" data-base-price="12500">12500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch41"><input id="ch41" type="checkbox">Электрика "ЕВРО" (кабель NYM)</label></td><td class="c-price" data-base-price="12000">12000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch42"><input id="ch42" type="checkbox">Душевая</label></td><td class="c-price" data-base-price="7500">7500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch43"><input id="ch43" type="checkbox">Унитаз</label></td><td class="c-price" data-base-price="7500">7500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch44"><input id="ch44" type="checkbox">Умывальник</label></td><td class="c-price" data-base-price="6500">6500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch45"><input id="ch45" type="checkbox">Конвектор 1,5 кВт*ч</label></td><td class="c-price" data-base-price="4700">4700</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch46"><input id="ch46" type="checkbox">Нары на два спальных места</label></td><td class="c-price" data-base-price="1900">1900</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch47"><input id="ch47" type="checkbox">цветной проф лист для внеш. отделки</label></td><td class="c-price" data-base-price="7500">7500</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch48"><input id="ch48" type="checkbox">Отделка внутренняя, вагонка хвойная (потолок, стены)</label></td><td class="c-price" data-base-price="22000">22000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch49"><input id="ch49" type="checkbox">Отделка внутренняя, ОСБи (потолок, стены)</label></td><td class="c-price" data-base-price="15000">15000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch50"><input id="ch50" type="checkbox">Отделка внутренняя, вагонка ПВХ (потолок, стены)</label></td><td class="c-price" data-base-price="10000">10000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch51"><input id="ch51" type="checkbox">Отделка внутренняя, профлист (потолок, стены)</label></td><td class="c-price" data-base-price="18000">18000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch52"><input id="ch52" type="checkbox">Пол из ЦСП 10мм</label></td><td class="c-price" data-base-price="12000">12000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
    <label for="ch53"><input id="ch53" type="checkbox">Сварная крыша</label></td><td class="c-price" data-base-price="20000">20000</td></tr>
<tr class="for-metal hidden"><td class="c-name">
     <label for="ch54"><input id="ch54" type="checkbox">Сборка на участке</label></td><td class="c-price" data-base-price="45000">45000</td></tr>
      

        <tr class="c-p-itogo">
            <td class="c-name c-itog">Итого:</td>
            <td id="c-price-itog"></td>
            <td></td>
        </tr>
    </tbody>
</table>
<h3 id="orderh3">Оформите заявку</h3>
<table id="order-table2">
    <tbody>
        <tr>
            <td width="35%"><label for="inpname">Имя<span style="color:red;">*</span>:</label></td>
            <td><input type="text" name="name" id="inpname" placeholder="Имя"></td>
        </tr>
        <tr>
            <td><label for="inptel">
E-mail или Телефон для связи<span style="color:red;">*</span>:</label></td>
            <td><input type="text" name="tel" id="inptel" placeholder="
E-mail или Телефон для связи"></td>
        </tr>
        <tr>
            <td><label for="inpcomment">Комментарий:</label></td>
            <td><textarea name="comment" id="inpcomment" placeholder="Комментарий"></textarea></td>
        </tr>
    </tbody>
</table>
<div style="height: 38px;padding-top:10px; text-align:center; margin-bottom: 25px;position: relative;"><span id="ajaxgo" class="button">Отправить</span>
<div id="successmsg"></div></div>
<div id="ajaxgohelper"><span></span></div>

<script type="text/javascript">
$(document).ready(function(){


	const priceForSize = {
		metalWithoutPartition: {'2,4x2,4': 1, '2,4x4': 2, '2,4x6': 3, '2,4x8': 4},
		metalWithStraightPartition: {'2,4x2,4': 5, '2,4x4': 6, '2,4x6': 7, '2,4x8': 8},
		metalWithDoublePartition: {'2,4x2,4': 9, '2,4x4': -2, '2,4x6': -3, '2,4x8': -4}
	}
	const square = {'2,4x2,4': 2.4*2.4, '2,4x4': 2.4*4, '2,4x6': 2.4*6, '2,4x8': 2.4*8};

$(".calk").find('a').click(function(){
    var t = $(this);
    var tp = t.parents('td');
    var ts = t.parent().siblings().find('a');

    if(tp.hasClass("calk-level2")){
        $(".calk-level2").find('.active').removeClass('active');
        //$('.calk-img-prev').find('img').attr('src',t.data('src'));
        $('.info-peregorodka').html(t.text());
        $('.info-price').html(t.data('price'));
        t.addClass('active');
        //$(".calk-img-prev").find('img').show();
        $(".bt-info").show();
        $('.todel').show();
        if(t.hasClass("show-for-derevo")){
            if($(".for-derevo").hasClass("hidden")){
                $(".for-metal").addClass("hidden");
                $(".for-derevo").removeClass("hidden");
                $(".for-metal").find("input").attr("checked",false);
            }
        $("#custom-order").find('input[name="metal-size"]')[2].checked = "checked"; // инициализация, выбор активно radio button
        }
        if(t.hasClass("show-for-metal")){
            if($(".for-metal").hasClass("hidden")){
                $(".for-derevo").addClass("hidden");
                $(".for-metal").removeClass("hidden");
                $(".for-derevo").find("input").attr("checked",false);
            }

						$("#custom-order").find('input[name="metal-size"]').each(function(index){ // инициализация, значение price для всех radio button
							var radioDataSizes = priceForSize[t.attr('data-changehouse')];
							var priceValue = radioDataSizes[$(this).attr('data-size')]
							$(this).attr('data-price', priceValue);
						});
						$("#custom-order").find('input[name="metal-size"]')[2].checked = "checked"; // инициализация, выбор активной radio button

        }
    }
    myCalc();
});

$(document.body).on("click", "#ajaxgo", send);

$(document.body).on("change", "select, input[type='radio'], input[type='checkbox']", myCalc);

$("#order-table2").on("focus", "input", function(){$(this).css("border","");});



/* пересчет цены */
function myCalc(){

	var selectMetalRadio = $("#custom-order").find('input[name="metal-size"]:checked')[0];
	if(selectMetalRadio) {
		var metalSizePrice = $(selectMetalRadio).attr('data-price');
		// запись значения в .c-price, из активного radio button, читает значение из data-price
		$(selectMetalRadio).closest('tr').children(".c-price").text(metalSizePrice);

		const activeLink = $(".calk a.active")[0];
		// базовая цена = базовая цена из data атр. пункта выбора бытовки + цена из группы radio button размеров
		const basePrice = +$(activeLink).attr('data-price') + +metalSizePrice;
		$('.info-price').html(basePrice);
	}

	// пересчет цены опций, в зависимости от размера
	$("#custom-order").find('tr[data-recalculation="uses"]').each(function(index){
		var selectSize;
		$("#custom-order").find('input[name="metal-size"]').each(function(index){if(this.checked) {selectSize = $(this).attr('data-size');}});

		const baseSquare = square['2,4x6'];
		var element = $(this).children(".c-price")[0];
		var optionBasePrice = +$(element).attr('data-base-price');
		var newPrice = optionBasePrice / baseSquare * square[selectSize];
		$(element).text('' + Math.ceil(newPrice) );
	});

    var input = $("#custom-order").find("input");
    if(!input.checked){input.parent().parent().removeClass("activetr");}
    var itogo = 0;
    itogo += parseInt($('.calk-level2').find('.active').data('price'));
     console.log(':',itogo); // это
    $("#custom-order").find("input:checked").each(function(){

        itogo += parseInt($(this).closest('tr').children(".c-price").text());
       // itogo += parseInt($(this).parent().text());// это
         console.log(':',itogo); // это
    });
    $("#custom-order").find("input:checked").each(function(){
        $(this).parent().parent().addClass("activetr");
    });
    if (itogo>0){console.log(itogo);$("#c-price-itog").text(itogo + " р.");}else{$("#c-price-itog").text("");

    }
}

//формирование и отправка сообщения
    function send(){
    var validate = true;
    if ($("#order-table2").find("input[name='name']").val().length < 1){
        $("#order-table2").find("input[name='name']").css("border","1px solid #D22");
        validate = false;}
    if ($("#order-table2").find("input[name='tel']").val().length < 1){
        $("#order-table2").find("input[name='tel']").css("border","1px solid #D22");
        validate = false;}
    if (validate){
    var need = "";
    
    if($(".calk-level2").find(".active").length){
    //if($(".calk-level1").find("active").length > 0 && $(".calk-level2").find("active").length){// это
        need += "<h1>"+$(".calk-level2").find(".active").text()+"</h1>";
    }
    need += "<h2>Комплектация:</h2>";
    $("#custom-order").find("input:checked").each(function(){
        need += "<li>"+$(this).parent().parent().html() + "</li>";
    });
    need += "<p><b>Контактная информация:</b><br>Имя – " + $("#order-table2").find("input[name='name']").val() + ";<br>Телефон – " + $("#order-table2").find("input[name='tel']").val() + "; </p>";
    if ($("#order-table2").find("textarea[name='comment']").val().length > 0){
        need += "<p>Комментарий к заявке: " + $("#order-table2").find("textarea[name='comment']").val()+"</p>";
    }
output = JSON.stringify(need);
console.log(output);
    $.ajax({
    type: "POST",
    data: {data1: output},
      url:'js/mail.php',
      dataType:'json',
      success: function(data){
          $("#ajaxgo").hide();
        $("#successmsg").html(data.result);
        $("#successmsg").fadeIn(300);
    },
    error: function(data){
        console.log("ошибка");
    }
    });
}
}
});
</script>